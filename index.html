<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/index.css">
  <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Roboto">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js" integrity="sha512-6+YN/9o9BWrk6wSfGxQGpt3EUK6XeHi6yeHV+TYD2GR0Sj/cggRpXr1BrAQf0as6XslxomMUxXp2vIl+fv0QRA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <title>Archive</title>
</head>
<body>
  <div class="nav">
    <a href="/">Archive</a>
    <div class="nav2">
      
      <span id="title">

      </span>
      <span id="artist">
        test
      </span>
    </div>
  </div>
  
  <div class="content">
    <iframe width="100%" height="100%" src="artists.php" frameborder="0"></iframe>
  </div>

  <div class="player_controlls">
    <button id="play_pause">play/pause</button>
    <input id="controll_bar" type="range" min="0" max="1" value="0" step=".0001">
    <span id="position">00:00</span>/
    <span id="duration">00:00</span>
    
  </div>
</body>
<script>
  let songs = [];
  let index, playing;
  const controll_bar = $("#controll_bar");
  const duration = $("#duration");
  const position = $("#position");
  const title = $("#title");
  const artist = $("#artist");

  function update_progress() {
    if (playing) {
      controll_bar.val(playing.howl.seek() / playing.howl.duration());
      duration.html(~~( playing.howl.duration() / 60 ) + ':' + ~~( playing.howl.duration() % 60 ).toLocaleString("en-US", {minimumIntegerDigits: 2}));
      position.html(~~( playing.howl.seek() / 60 ) + ':'+ ~~( playing.howl.seek() % 60 )).toLocaleString("en-US", {minimumIntegerDigits: 2});
      title.html(playing.title);
      artist.html(playing.artist);
    } else {
      controll_bar.val(0);
      duration.html("00:00");
      position.html("00:00");
      title.html("");
      artist.html("");
    }
    window.requestAnimationFrame(update_progress);
  }

  $("#play_pause").click(function() { 
    if (playing.howl.playing()) {
      playing.howl.pause();
    } else {
      playing.howl.play();
    }
  })


  window.onmessage = function(e) {
    if (e.data.type === "play") {
      if (playing) {
        playing.howl.stop();
      }

      songs = e.data.songs.map(function(song) {
        song.howl = new Howl({
          src: [song.path],
          html5: true
        });

        song.howl.on("end", function() {
          index++;
          if (index >= songs.length) return;
          songs[index].howl.play();
          playing = songs[index];
        })

        return song;
      });
      index = e.data.index;
      
      songs[index].howl.play();
      playing = songs[index];
    }

    window.requestAnimationFrame(update_progress);
  }
</script>
</html>
